name: text-guard

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main, "**" ]

jobs:
  guard:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Fail if any file contains UTF-8 BOM
        shell: bash
        run: |
          set -euo pipefail
          bad=$(git grep -l $'^\xEF\xBB\xBF' -- . || true)
          if [ -n "$bad" ]; then
            echo "ERROR: UTF-8 BOM found in:"
            echo "$bad"
            exit 1
          fi

      - name: Fail if any tracked text file contains CRLF
        shell: bash
        run: |
          set -euo pipefail
          bad=$(git grep -Il $'\r' -- . || true)
          if [ -n "$bad" ]; then
            echo "ERROR: CRLF line endings found (first few shown):"
            echo "$bad" | head -n 50
            echo
            echo "Tip (after .gitattributes merges):"
            echo "  git rm --cached -r . && git reset --hard"
            exit 1
          fi
