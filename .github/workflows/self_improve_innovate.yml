name: Self Innovate (Idea-Only)

# Safety: Idea generation workflow (artifact-based, read-only)
# - Generates innovation ideas without modifying repository
# - Outputs ideas as workflow artifact for manual review
# - Ideas can be manually committed after human approval
# - Permissions: read-only (downgraded from write for safety)

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  self-innovate:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Ensure directories
        run: |
          mkdir -p data/self_innovate
          mkdir -p docs/self_innovate

      - name: Initialise idea pool if missing
        run: |
          IDEA_FILE="data/self_innovate/idea_pool.jsonl"
          if [ ! -f "$IDEA_FILE" ]; then
            touch "$IDEA_FILE"
          fi

      - name: Append placeholder innovation idea
        run: |
          IDEA_FILE="data/self_innovate/idea_pool.jsonl"
          TS="$(date -u +"%Y-%m-%dT%H:%M:%SZ")"

          echo "{
            \"id\": \"SI-${TS}\",
            \"timestamp_utc\": \"$TS\",
            \"source\": \"placeholder\",
            \"area\": \"developer_experience\",
            \"problem_observed\": \"Example: navigation to Self-Improve is not obvious from Sessions.\",
            \"idea\": \"Add a small 'Self-Improve This' button on Sessions page to open the self-improve console with context.\",
            \"impact_score\": 0.8,
            \"effort_score\": 0.3,
            \"risk_score\": 0.2,
            \"alignment_score\": 0.9,
            \"status\": \"candidate\"
          }" >> "$IDEA_FILE"

      - name: Upload idea pool as artifact (for manual review)
        uses: actions/upload-artifact@v4
        with:
          name: innovation-ideas
          path: data/self_innovate/idea_pool.jsonl

      - name: Instructions for manual commit
        run: |
          echo "âœ… Innovation idea generated successfully!"
          echo ""
          echo "ðŸ“‹ To commit this idea to the repository:"
          echo "1. Download the 'innovation-ideas' artifact from this workflow run"
          echo "2. Review the idea in idea_pool.jsonl"
          echo "3. If approved, manually commit to data/self_innovate/idea_pool.jsonl"
          echo "4. Or use: git add data/self_innovate/idea_pool.jsonl && git commit -m 'chore: add innovation idea'"
          echo ""
          echo "ðŸ”’ Safety: This workflow uses read-only permissions and cannot modify the repository."
