name: Sync Labels

on:
  push:
    paths: [".github/labels.json"]
  workflow_dispatch: {}

permissions:
  issues: write
  contents: read

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Apply labels from labels.json
        uses: actions/github-script@v7
        with:
          script: |
            const fs = require('fs');
            const labels = JSON.parse(fs.readFileSync('.github/labels.json','utf8'));
            for (const l of labels) {
              try {
                await github.rest.issues.createLabel({
                  owner: context.repo.owner, repo: context.repo.repo,
                  name: l.name, color: l.color.replace('#',''), description: l.description || ''
                });
                core.info(`Created label ${l.name}`);
              } catch (e) {
                if (e.status === 422) {
                  await github.rest.issues.updateLabel({
                    owner: context.repo.owner, repo: context.repo.repo,
                    name: l.name, color: l.color.replace('#',''), description: l.description || ''
                  });
                  core.info(`Updated label ${l.name}`);
                } else {
                  throw e;
                }
              }
            }
