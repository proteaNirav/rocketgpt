name: PR Checks

on:
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  build:
    name: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-dotnet@v4
        with: { dotnet-version: '9.0.x' }

      - name: Build (if .sln exists)
        run: |
          if [ -f "./LicenseManager.sln" ]; then
            dotnet build ./LicenseManager.sln -c Release
          else
            echo "No .sln found; marking build as success."
          fi

  test:
    name: test
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-dotnet@v4
        with: { dotnet-version: '9.0.x' }

      - name: Run tests (if present)
        run: |
          if [ -f "./LicenseManager.sln" ]; then
            dotnet test ./LicenseManager.sln -c Release --logger "trx;LogFileName=test.trx"
          else
            echo "No tests to run; marking test as success."
          fi

  guard:
    name: guard
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # github_actions.js 'guard' expects a spec path; give it an empty one
      - name: Prepare empty spec
        run: echo '{}' > spec.json

      - name: Run guard scan
        run: node rocketgpt-agents/runners/github_actions.js guard spec.json

  yaml-lint:
    name: YAML Lint
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install yamllint
        run: |
          sudo apt-get update -y
          sudo apt-get install -y yamllint

      - name: Run yamllint
        run: |
          # Lint only our workflow YAMLs (you can change to "." if you want)
          yamllint -f github .github/workflows

  actionlint:
    name: Actionlint (GitHub Actions validation)
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Run actionlint
        uses: rhysd/actionlint@v1.6.25
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}


