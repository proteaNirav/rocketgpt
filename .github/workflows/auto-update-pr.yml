name: Auto Update PR Branches
on:
  push:
    branches: [ "main", "develop" ]
  schedule:
    - cron: "*/30 * * * *"
permissions:
  contents: write
  pull-requests: write
jobs:
  update-branches:
    runs-on: ubuntu-latest
    steps:
      - name: Update stale PR branches from same repo
        uses: actions/github-script@v7
        with:
          script: |
            const bases = ["main","develop"];
            for (const base of bases) {
              const prs = await github.paginate(github.rest.pulls.list, {
                owner: context.repo.owner, repo: context.repo.repo, state: "open", base, per_page: 100
              });
              for (const pr of prs) {
                if (!pr.head.repo || pr.head.repo.full_name !== `${context.repo.owner}/${context.repo.repo}`) continue;
                try {
                  await github.rest.pulls.updateBranch({
                    owner: context.repo.owner, repo: context.repo.repo, pull_number: pr.number
                  });
                  core.notice(`Updated PR #${pr.number} against ${base}`);
                } catch (e) {
                  core.warning(`PR #${pr.number} not updated: ${e.message}`);
                }
              }
            }
