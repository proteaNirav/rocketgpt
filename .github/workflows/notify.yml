name: Notify on Pipeline

# Safety: Notification-only workflow (read-only)
# - Triggered on completion of other workflows
# - Only sends notifications to Slack/Teams if configured
# - No repository modifications
# - Permissions: read-only on contents

on:
  workflow_run:
    workflows: ["AI Codegen", "AI PR Review", "RocketGPT Review Pipeline"]
    types: [completed]

permissions:
  contents: read

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Build message
        id: msg
        run: |
          echo "text=Workflow '${{ github.event.workflow_run.name }}' ${{ github.event.workflow_run.conclusion }} for ${{ github.event.workflow_run.event }} on ${{ github.event.workflow_run.head_branch || 'n/a' }} (run #${{ github.event.workflow_run.id }})." >> $GITHUB_OUTPUT

      - name: Slack (if configured)
        if: ${{ vars.SLACK_WEBHOOK_URL != '' }}
        run: |
          curl -sS -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"${{ steps.msg.outputs.text }}\"}" \
          "${{ vars.SLACK_WEBHOOK_URL }}"

      - name: Teams (if configured)
        if: ${{ vars.TEAMS_WEBHOOK_URL != '' }}
        run: |
          curl -sS -X POST -H 'Content-type: application/json' \
          --data "{\"text\":\"${{ steps.msg.outputs.text }}\"}" \
          "${{ vars.TEAMS_WEBHOOK_URL }}"



